<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenVibe - AI App Builder Open Source</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .code-editor {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .phone-frame {
            box-shadow: 0 0 0 12px #1f2937, 0 0 0 13px #374151, 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border-radius: 40px;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .animate-pulse-slow {
            animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .preview-iframe {
            border: none;
            width: 100%;
            height: 100%;
            background: white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Component Library for Preview
        const PreviewComponents = {
            View: ({ children, style = {} }) => (
                <div style={{ display: 'flex', flexDirection: 'column', ...style }}>
                    {children}
                </div>
            ),
            Text: ({ children, style = {} }) => (
                <span style={{ fontSize: 16, color: '#000', ...style }}>
                    {children}
                </span>
            ),
            Button: ({ title, onPress, style = {} }) => (
                <button
                    onClick={onPress}
                    style={{
                        padding: '12px 24px',
                        backgroundColor: '#667eea',
                        color: 'white',
                        border: 'none',
                        borderRadius: 8,
                        cursor: 'pointer',
                        fontSize: 16,
                        fontWeight: 500,
                        ...style
                    }}
                >
                    {title}
                </button>
            ),
            TextInput: ({ placeholder, value, onChangeText, style = {} }) => (
                <input
                    type="text"
                    placeholder={placeholder}
                    value={value}
                    onChange={(e) => onChangeText?.(e.target.value)}
                    style={{
                        padding: '12px',
                        border: '1px solid #d1d5db',
                        borderRadius: 8,
                        fontSize: 16,
                        width: '100%',
                        ...style
                    }}
                />
            ),
            ScrollView: ({ children, style = {} }) => (
                <div style={{ overflow: 'auto', ...style }}>
                    {children}
                </div>
            ),
            Image: ({ source, style = {} }) => (
                <img
                    src={source?.uri || source}
                    style={{ maxWidth: '100%', ...style }}
                    alt=""
                />
            )
        };

        const OpenVibeApp = () => {
            const [projects, setProjects] = useState([]);
            const [currentProject, setCurrentProject] = useState(null);
            const [prompt, setPrompt] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [view, setView] = useState('projects'); // projects, editor, preview
            const [code, setCode] = useState('');
            const [logs, setLogs] = useState([]);
            const [projectName, setProjectName] = useState('');
            const [showNameModal, setShowNameModal] = useState(false);

            useEffect(() => {
                loadProjects();
            }, []);

            const loadProjects = async () => {
                try {
                    const result = await window.storage.list('project:');
                    if (result?.keys) {
                        const projectPromises = result.keys.map(async (key) => {
                            const data = await window.storage.get(key);
                            return data ? JSON.parse(data.value) : null;
                        });
                        const loadedProjects = await Promise.all(projectPromises);
                        setProjects(loadedProjects.filter(p => p !== null));
                    }
                } catch (error) {
                    console.log('Nenhum projeto salvo ainda');
                }
            };

            const saveProject = async (project) => {
                try {
                    await window.storage.set(
                        `project:${project.id}`,
                        JSON.stringify(project)
                    );
                    await loadProjects();
                } catch (error) {
                    addLog('Erro ao salvar projeto', 'error');
                }
            };

            const deleteProject = async (projectId) => {
                try {
                    await window.storage.delete(`project:${projectId}`);
                    await loadProjects();
                    if (currentProject?.id === projectId) {
                        setCurrentProject(null);
                        setView('projects');
                    }
                    addLog('Projeto deletado com sucesso', 'success');
                } catch (error) {
                    addLog('Erro ao deletar projeto', 'error');
                }
            };

            const addLog = (message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString();
                setLogs(prev => [...prev, { message, type, timestamp }]);
            };

            const generateApp = async () => {
                if (!prompt.trim()) return;

                setIsGenerating(true);
                addLog('Gerando c√≥digo com IA...', 'info');

                try {
                    const systemPrompt = `Voc√™ √© um expert em React Native. Gere c√≥digo React Native completo e funcional baseado no prompt do usu√°rio.

Regras importantes:
1. Use APENAS componentes React Native nativos: View, Text, Button, TextInput, ScrollView, Image, TouchableOpacity
2. Use hooks do React: useState, useEffect quando necess√°rio
3. O c√≥digo deve ser limpo, bem estruturado e comentado
4. Retorne APENAS o c√≥digo JavaScript, sem explica√ß√µes
5. O c√≥digo deve come√ßar com: const App = () => {
6. Termine com: export default App;
7. Use estilos inline ou StyleSheet
8. Fa√ßa o app ser visualmente atraente e funcional

Exemplo de estrutura:
\`\`\`javascript
import React, { useState } from 'react';
import { View, Text, Button, StyleSheet } from 'react-native';

const App = () => {
  const [count, setCount] = useState(0);
  
  return (
    <View style={styles.container}>
      <Text style={styles.title}>Meu App</Text>
      <Text style={styles.count}>{count}</Text>
      <Button title="Incrementar" onPress={() => setCount(count + 1)} />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: '#f5f5f5',
    padding: 20,
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    marginBottom: 20,
  },
  count: {
    fontSize: 48,
    fontWeight: 'bold',
    marginBottom: 20,
    color: '#667eea',
  },
});

export default App;
\`\`\``;

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 4000,
                            messages: [
                                {
                                    role: 'user',
                                    content: `${systemPrompt}\n\nPrompt do usu√°rio: ${prompt}\n\nGere o c√≥digo React Native completo:`
                                }
                            ]
                        })
                    });

                    const data = await response.json();
                    let generatedCode = data.content[0].text;

                    // Clean up the code
                    generatedCode = generatedCode.replace(/```javascript\n?/g, '');
                    generatedCode = generatedCode.replace(/```\n?/g, '');
                    generatedCode = generatedCode.trim();

                    setCode(generatedCode);
                    
                    if (currentProject) {
                        const updatedProject = {
                            ...currentProject,
                            code: generatedCode,
                            lastModified: new Date().toISOString(),
                            history: [...(currentProject.history || []), {
                                prompt,
                                code: generatedCode,
                                timestamp: new Date().toISOString()
                            }]
                        };
                        setCurrentProject(updatedProject);
                        await saveProject(updatedProject);
                    }

                    addLog('C√≥digo gerado com sucesso!', 'success');
                    setPrompt('');
                    setView('editor');
                } catch (error) {
                    addLog(`Erro ao gerar c√≥digo: ${error.message}`, 'error');
                } finally {
                    setIsGenerating(false);
                }
            };

            const createNewProject = () => {
                setShowNameModal(true);
            };

            const confirmCreateProject = () => {
                if (!projectName.trim()) return;

                const newProject = {
                    id: Date.now().toString(),
                    name: projectName,
                    code: '',
                    created: new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    history: []
                };

                setCurrentProject(newProject);
                saveProject(newProject);
                setProjectName('');
                setShowNameModal(false);
                setView('editor');
                addLog(`Projeto "${newProject.name}" criado`, 'success');
            };

            const openProject = (project) => {
                setCurrentProject(project);
                setCode(project.code || '');
                setView('editor');
                addLog(`Projeto "${project.name}" aberto`, 'info');
            };

            const exportCode = () => {
                if (!code) return;
                
                const blob = new Blob([code], { type: 'text/javascript' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${currentProject?.name || 'app'}.js`;
                a.click();
                URL.revokeObjectURL(url);
                addLog('C√≥digo exportado com sucesso', 'success');
            };

            const renderPreview = () => {
                if (!code) return <div className="flex items-center justify-center h-full text-gray-500">Nenhum c√≥digo para visualizar</div>;

                try {
                    // Create a safe preview component
                    const previewCode = code
                        .replace(/import.*from.*;/g, '')
                        .replace(/export default App;/g, '');

                    const PreviewApp = new Function(
                        'React',
                        'useState',
                        'useEffect',
                        'View',
                        'Text',
                        'Button',
                        'TextInput',
                        'ScrollView',
                        'Image',
                        'TouchableOpacity',
                        `
                        ${previewCode}
                        return App;
                        `
                    )(
                        React,
                        useState,
                        useEffect,
                        PreviewComponents.View,
                        PreviewComponents.Text,
                        PreviewComponents.Button,
                        PreviewComponents.TextInput,
                        PreviewComponents.ScrollView,
                        PreviewComponents.Image,
                        ({ children, onPress, style }) => (
                            <div onClick={onPress} style={{ cursor: 'pointer', ...style }}>
                                {children}
                            </div>
                        )
                    );

                    return <PreviewApp />;
                } catch (error) {
                    return (
                        <div className="flex items-center justify-center h-full text-red-500 p-4">
                            <div className="text-center">
                                <p className="font-bold mb-2">Erro no c√≥digo:</p>
                                <p className="text-sm">{error.message}</p>
                            </div>
                        </div>
                    );
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="gradient-bg text-white shadow-lg">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-3">
                                    <div className="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                                        <span className="text-2xl">‚ö°</span>
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold">OpenVibe</h1>
                                        <p className="text-sm opacity-90">Open Source AI App Builder</p>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-4">
                                    {currentProject && (
                                        <div className="text-right hidden md:block">
                                            <p className="font-semibold">{currentProject.name}</p>
                                            <p className="text-xs opacity-75">
                                                Modificado: {new Date(currentProject.lastModified).toLocaleString()}
                                            </p>
                                        </div>
                                    )}
                                    <button
                                        onClick={() => setView('projects')}
                                        className="px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition"
                                    >
                                        Projetos
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <div className="container mx-auto px-4 py-8">
                        {view === 'projects' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">Meus Projetos</h2>
                                    <button
                                        onClick={createNewProject}
                                        className="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition flex items-center space-x-2"
                                    >
                                        <span className="text-xl">+</span>
                                        <span>Novo Projeto</span>
                                    </button>
                                </div>

                                {projects.length === 0 ? (
                                    <div className="text-center py-20">
                                        <div className="text-6xl mb-4">üì±</div>
                                        <h3 className="text-xl font-semibold text-gray-700 mb-2">
                                            Nenhum projeto ainda
                                        </h3>
                                        <p className="text-gray-500 mb-6">
                                            Crie seu primeiro app com IA agora!
                                        </p>
                                        <button
                                            onClick={createNewProject}
                                            className="px-8 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition"
                                        >
                                            Criar Primeiro Projeto
                                        </button>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {projects.map(project => (
                                            <div
                                                key={project.id}
                                                className="bg-white rounded-xl shadow-md hover:shadow-xl transition p-6 cursor-pointer"
                                                onClick={() => openProject(project)}
                                            >
                                                <div className="flex justify-between items-start mb-4">
                                                    <div className="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg flex items-center justify-center text-white text-xl">
                                                        üì±
                                                    </div>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            if (confirm(`Deletar projeto "${project.name}"?`)) {
                                                                deleteProject(project.id);
                                                            }
                                                        }}
                                                        className="text-red-500 hover:text-red-700"
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                                <h3 className="text-lg font-bold text-gray-800 mb-2">
                                                    {project.name}
                                                </h3>
                                                <p className="text-sm text-gray-500 mb-4">
                                                    Criado: {new Date(project.created).toLocaleDateString()}
                                                </p>
                                                <div className="flex items-center justify-between text-xs text-gray-400">
                                                    <span>{project.history?.length || 0} itera√ß√µes</span>
                                                    <span>
                                                        {project.code ? `${Math.round(project.code.length / 1000)}KB` : '0KB'}
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'editor' && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                {/* Left Panel - Editor */}
                                <div className="space-y-6">
                                    {/* AI Prompt */}
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h3 className="text-lg font-bold mb-4 text-gray-800">
                                            ‚ú® Prompt IA
                                        </h3>
                                        <textarea
                                            value={prompt}
                                            onChange={(e) => setPrompt(e.target.value)}
                                            placeholder="Descreva o app que voc√™ quer criar...&#10;&#10;Ex: Crie um app de contador com bot√µes para incrementar e decrementar"
                                            className="w-full h-32 p-4 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none resize-none"
                                            disabled={isGenerating}
                                        />
                                        <button
                                            onClick={generateApp}
                                            disabled={isGenerating || !prompt.trim()}
                                            className={`w-full mt-4 py-3 rounded-lg font-semibold transition ${
                                                isGenerating || !prompt.trim()
                                                    ? 'bg-gray-300 cursor-not-allowed'
                                                    : 'bg-purple-600 hover:bg-purple-700 text-white'
                                            }`}
                                        >
                                            {isGenerating ? (
                                                <span className="flex items-center justify-center">
                                                    <span className="animate-pulse-slow mr-2">‚ö°</span>
                                                    Gerando...
                                                </span>
                                            ) : (
                                                'Gerar App com IA'
                                            )}
                                        </button>
                                    </div>

                                    {/* Code Editor */}
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-bold text-gray-800">
                                                üíª C√≥digo
                                            </h3>
                                            <div className="flex space-x-2">
                                                <button
                                                    onClick={exportCode}
                                                    disabled={!code}
                                                    className={`px-4 py-2 rounded-lg text-sm font-semibold transition ${
                                                        code
                                                            ? 'bg-blue-500 hover:bg-blue-600 text-white'
                                                            : 'bg-gray-300 cursor-not-allowed text-gray-500'
                                                    }`}
                                                >
                                                    üì• Exportar
                                                </button>
                                            </div>
                                        </div>
                                        <textarea
                                            value={code}
                                            onChange={(e) => setCode(e.target.value)}
                                            className="w-full h-96 p-4 bg-gray-900 text-green-400 rounded-lg code-editor font-mono scrollbar-hide"
                                            placeholder="// O c√≥digo gerado aparecer√° aqui..."
                                            spellCheck={false}
                                        />
                                    </div>

                                    {/* Logs */}
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h3 className="text-lg font-bold mb-4 text-gray-800">
                                            üìä Logs
                                        </h3>
                                        <div className="h-40 overflow-y-auto space-y-2 scrollbar-hide">
                                            {logs.length === 0 ? (
                                                <p className="text-gray-400 text-sm">Nenhum log ainda...</p>
                                            ) : (
                                                logs.slice(-10).reverse().map((log, i) => (
                                                    <div
                                                        key={i}
                                                        className={`text-sm p-2 rounded ${
                                                            log.type === 'error'
                                                                ? 'bg-red-50 text-red-700'
                                                                : log.type === 'success'
                                                                ? 'bg-green-50 text-green-700'
                                                                : 'bg-blue-50 text-blue-700'
                                                        }`}
                                                    >
                                                        <span className="font-mono text-xs opacity-75">
                                                            [{log.timestamp}]
                                                        </span>{' '}
                                                        {log.message}
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* Right Panel - Preview */}
                                <div className="lg:sticky lg:top-8 h-fit">
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h3 className="text-lg font-bold mb-4 text-gray-800">
                                            üì± Preview
                                        </h3>
                                        <div className="flex justify-center">
                                            <div className="phone-frame bg-white" style={{ width: 375, height: 667 }}>
                                                <div className="w-full h-full overflow-auto scrollbar-hide">
                                                    {renderPreview()}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Name Modal */}
                    {showNameModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                                <h2 className="text-2xl font-bold mb-4 text-gray-800">
                                    Novo Projeto
                                </h2>
                                <input
                                    type="text"
                                    value={projectName}
                                    onChange={(e) => setProjectName(e.target.value)}
                                    placeholder="Nome do projeto..."
                                    className="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none mb-6"
                                    autoFocus
                                    onKeyPress={(e) => e.key === 'Enter' && confirmCreateProject()}
                                />
                                <div className="flex space-x-3">
                                    <button
                                        onClick={() => {
                                            setShowNameModal(false);
                                            setProjectName('');
                                        }}
                                        className="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={confirmCreateProject}
                                        disabled={!projectName.trim()}
                                        className={`flex-1 px-6 py-3 rounded-lg font-semibold transition ${
                                            projectName.trim()
                                                ? 'bg-purple-600 hover:bg-purple-700 text-white'
                                                : 'bg-gray-300 cursor-not-allowed text-gray-500'
                                        }`}
                                    >
                                        Criar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <footer className="bg-gray-800 text-white mt-20 py-8">
                        <div className="container mx-auto px-4 text-center">
                            <p className="mb-2">
                                <strong>OpenVibe</strong> - Open Source AI App Builder
                            </p>
                            <p className="text-sm text-gray-400">
                                100% gr√°tis, sem limites de prompts, totalmente open source
                            </p>
                            <p className="text-xs text-gray-500 mt-4">
                                Constru√≠do com React + Claude API ‚Ä¢ Licen√ßa MIT
                            </p>
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<OpenVibeApp />, document.getElementById('root'));
    </script>
</body>
</html>