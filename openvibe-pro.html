<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenVibe Pro - AI App Builder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .gradient-bg-dark {
            background: linear-gradient(135deg, #1e3a8a 0%, #4c1d95 100%);
        }

        .code-editor {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .phone-frame {
            box-shadow: 0 0 0 12px #1f2937, 0 0 0 13px #374151, 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border-radius: 40px;
        }

        .phone-frame-light {
            box-shadow: 0 0 0 12px #e5e7eb, 0 0 0 13px #d1d5db, 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .animate-pulse-slow {
            animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        .dark {
            color-scheme: dark;
        }

        .template-card {
            transition: all 0.3s ease;
        }

        .template-card:hover {
            transform: translateY(-4px);
        }

        .tab-active {
            border-bottom: 3px solid #667eea;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Templates pr√©-constru√≠dos
        const TEMPLATES = [
            {
                id: 'counter',
                name: 'Contador',
                category: 'B√°sico',
                icon: 'üî¢',
                description: 'Contador simples com bot√µes + e -',
                prompt: 'Crie um contador com um n√∫mero grande no centro, bot√µes verde "+" para incrementar, bot√£o vermelho "-" para decrementar, e bot√£o cinza "Reset". Use cores vibrantes e design moderno.'
            },
            {
                id: 'todo',
                name: 'Lista de Tarefas',
                category: 'Produtividade',
                icon: '‚úì',
                description: 'Gerenciador de tarefas completo',
                prompt: 'Crie um app de lista de tarefas com header roxo, input para adicionar tarefas, lista com checkbox para marcar como conclu√≠da, bot√£o para deletar, e contador de tarefas pendentes no rodap√©.'
            },
            {
                id: 'calculator',
                name: 'Calculadora',
                category: 'Utilidades',
                icon: 'üßÆ',
                description: 'Calculadora com 4 opera√ß√µes',
                prompt: 'Crie uma calculadora com display grande no topo, bot√µes de 0-9 em grid, bot√µes de opera√ß√µes (+, -, √ó, √∑), bot√£o "=" para calcular, bot√£o "C" para limpar. Design colorido e moderno.'
            },
            {
                id: 'quiz',
                name: 'Quiz',
                category: 'Entretenimento',
                icon: 'üéØ',
                description: 'Quiz de m√∫ltipla escolha',
                prompt: 'Crie um quiz com 5 perguntas, mostrando uma pergunta por vez, 4 op√ß√µes de resposta (A, B, C, D), feedback visual (verde/vermelho), barra de progresso, e tela final com pontua√ß√£o.'
            },
            {
                id: 'timer',
                name: 'Pomodoro',
                category: 'Produtividade',
                icon: '‚è±Ô∏è',
                description: 'Timer Pomodoro',
                prompt: 'Crie um timer Pomodoro com display MM:SS, bot√µes para 25min/5min/15min, bot√µes Iniciar/Pausar/Resetar, barra de progresso circular, e contador de pomodoros completados.'
            },
            {
                id: 'tip',
                name: 'Calculadora de Gorjeta',
                category: 'Utilidades',
                icon: 'üí∞',
                description: 'Calcule gorjetas facilmente',
                prompt: 'Crie uma calculadora de gorjeta com input para valor da conta, slider para porcentagem (0-30%), card mostrando valor da gorjeta e total, e op√ß√£o para dividir entre pessoas.'
            },
            {
                id: 'expense',
                name: 'Rastreador de Gastos',
                category: 'Finan√ßas',
                icon: 'üí∏',
                description: 'Controle suas despesas',
                prompt: 'Crie um app para rastrear despesas com form para adicionar (descri√ß√£o e valor), lista de despesas com bot√£o de remover, total geral em destaque verde/vermelho.'
            },
            {
                id: 'water',
                name: 'Contador de √Ågua',
                category: 'Sa√∫de',
                icon: 'üíß',
                description: 'Rastreie consumo de √°gua',
                prompt: 'Crie um app de consumo de √°gua com meta de 2L, display mostrando progresso, bot√µes para adicionar 200ml/500ml/1L, barra de progresso azul, e hist√≥rico do dia.'
            },
            {
                id: 'password',
                name: 'Gerador de Senhas',
                category: 'Seguran√ßa',
                icon: 'üîê',
                description: 'Gere senhas seguras',
                prompt: 'Crie um gerador de senhas com slider para comprimento (8-32), checkboxes para mai√∫sculas/min√∫sculas/n√∫meros/s√≠mbolos, display da senha, bot√µes Gerar/Copiar, e indicador de for√ßa.'
            },
            {
                id: 'converter',
                name: 'Conversor de Unidades',
                category: 'Utilidades',
                icon: 'üîÑ',
                description: 'Converta temperatura, peso, etc',
                prompt: 'Crie um conversor com tabs para Temperatura/Comprimento/Peso, input para valor, dropdowns para unidade origem/destino, resultado em tempo real, e bot√£o limpar.'
            },
            {
                id: 'tictactoe',
                name: 'Jogo da Velha',
                category: 'Jogos',
                icon: '‚≠ï',
                description: 'Jogo cl√°ssico 3x3',
                prompt: 'Crie jogo da velha com grid 3x3, altern√¢ncia X/O, destaque do vencedor, mensagem de empate, bot√£o "Novo Jogo", placar de vit√≥rias, e design colorido.'
            },
            {
                id: 'flashcard',
                name: 'Flashcards',
                category: 'Educa√ß√£o',
                icon: 'üìö',
                description: 'Estude com flashcards',
                prompt: 'Crie flashcards de ingl√™s com palavra em portugu√™s, bot√£o Revelar para ingl√™s, bot√µes Sei/N√£o Sei, pr√≥ximo card autom√°tico, contador de progresso, e 20 palavras comuns.'
            }
        ];

        // Component Library for Preview
        const PreviewComponents = {
            View: ({ children, style = {} }) => (
                <div style={{ display: 'flex', flexDirection: 'column', ...style }}>
                    {children}
                </div>
            ),
            Text: ({ children, style = {} }) => (
                <span style={{ fontSize: 16, color: '#000', ...style }}>
                    {children}
                </span>
            ),
            Button: ({ title, onPress, style = {} }) => (
                <button
                    onClick={onPress}
                    style={{
                        padding: '12px 24px',
                        backgroundColor: '#667eea',
                        color: 'white',
                        border: 'none',
                        borderRadius: 8,
                        cursor: 'pointer',
                        fontSize: 16,
                        fontWeight: 500,
                        ...style
                    }}
                >
                    {title}
                </button>
            ),
            TextInput: ({ placeholder, value, onChangeText, style = {} }) => (
                <input
                    type="text"
                    placeholder={placeholder}
                    value={value}
                    onChange={(e) => onChangeText?.(e.target.value)}
                    style={{
                        padding: '12px',
                        border: '1px solid #d1d5db',
                        borderRadius: 8,
                        fontSize: 16,
                        width: '100%',
                        ...style
                    }}
                />
            ),
            ScrollView: ({ children, style = {} }) => (
                <div style={{ overflow: 'auto', ...style }}>
                    {children}
                </div>
            ),
            Image: ({ source, style = {} }) => (
                <img
                    src={source?.uri || source}
                    style={{ maxWidth: '100%', ...style }}
                    alt=""
                />
            )
        };

        const OpenVibeProApp = () => {
            const [projects, setProjects] = useState([]);
            const [currentProject, setCurrentProject] = useState(null);
            const [prompt, setPrompt] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [view, setView] = useState('projects');
            const [code, setCode] = useState('');
            const [logs, setLogs] = useState([]);
            const [projectName, setProjectName] = useState('');
            const [showNameModal, setShowNameModal] = useState(false);
            const [showTemplates, setShowTemplates] = useState(false);
            const [selectedCategory, setSelectedCategory] = useState('Todos');
            const [darkMode, setDarkMode] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [activeTab, setActiveTab] = useState('prompt');

            useEffect(() => {
                loadProjects();
                loadTheme();
            }, []);

            useEffect(() => {
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [darkMode]);

            const loadTheme = async () => {
                try {
                    const result = await window.storage.get('theme');
                    if (result?.value === 'dark') {
                        setDarkMode(true);
                    }
                } catch (error) {
                    console.log('No theme saved');
                }
            };

            const toggleTheme = async () => {
                const newMode = !darkMode;
                setDarkMode(newMode);
                try {
                    await window.storage.set('theme', newMode ? 'dark' : 'light');
                } catch (error) {
                    console.log('Could not save theme');
                }
            };

            const loadProjects = async () => {
                try {
                    const result = await window.storage.list('project:');
                    if (result?.keys) {
                        const projectPromises = result.keys.map(async (key) => {
                            const data = await window.storage.get(key);
                            return data ? JSON.parse(data.value) : null;
                        });
                        const loadedProjects = await Promise.all(projectPromises);
                        setProjects(loadedProjects.filter(p => p !== null));
                    }
                } catch (error) {
                    console.log('Nenhum projeto salvo ainda');
                }
            };

            const saveProject = async (project) => {
                try {
                    await window.storage.set(
                        `project:${project.id}`,
                        JSON.stringify(project)
                    );
                    await loadProjects();
                } catch (error) {
                    addLog('Erro ao salvar projeto', 'error');
                }
            };

            const deleteProject = async (projectId) => {
                try {
                    await window.storage.delete(`project:${projectId}`);
                    await loadProjects();
                    if (currentProject?.id === projectId) {
                        setCurrentProject(null);
                        setView('projects');
                    }
                    addLog('Projeto deletado com sucesso', 'success');
                } catch (error) {
                    addLog('Erro ao deletar projeto', 'error');
                }
            };

            const duplicateProject = async (project) => {
                const newProject = {
                    ...project,
                    id: Date.now().toString(),
                    name: `${project.name} (C√≥pia)`,
                    created: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                };
                await saveProject(newProject);
                addLog(`Projeto "${newProject.name}" duplicado`, 'success');
            };

            const addLog = (message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString();
                setLogs(prev => [...prev, { message, type, timestamp }]);
            };

            const generateApp = async () => {
                if (!prompt.trim()) return;

                setIsGenerating(true);
                addLog('Gerando c√≥digo com IA...', 'info');

                try {
                    const systemPrompt = `Voc√™ √© um expert em React Native. Gere c√≥digo React Native completo e funcional baseado no prompt do usu√°rio.

Regras importantes:
1. Use APENAS componentes React Native nativos: View, Text, Button, TextInput, ScrollView, Image, TouchableOpacity
2. Use hooks do React: useState, useEffect quando necess√°rio
3. O c√≥digo deve ser limpo, bem estruturado e comentado
4. Retorne APENAS o c√≥digo JavaScript, sem explica√ß√µes
5. O c√≥digo deve come√ßar com: const App = () => {
6. Termine com: export default App;
7. Use estilos inline ou StyleSheet
8. Fa√ßa o app ser visualmente atraente e funcional
9. Use cores vibrantes e design moderno
10. Adicione tratamento de erros quando apropriado`;

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 4000,
                            messages: [
                                {
                                    role: 'user',
                                    content: `${systemPrompt}\n\nPrompt do usu√°rio: ${prompt}\n\nGere o c√≥digo React Native completo:`
                                }
                            ]
                        })
                    });

                    const data = await response.json();
                    let generatedCode = data.content[0].text;

                    generatedCode = generatedCode.replace(/```javascript\n?/g, '');
                    generatedCode = generatedCode.replace(/```\n?/g, '');
                    generatedCode = generatedCode.trim();

                    setCode(generatedCode);
                    
                    if (currentProject) {
                        const updatedProject = {
                            ...currentProject,
                            code: generatedCode,
                            lastModified: new Date().toISOString(),
                            history: [...(currentProject.history || []), {
                                prompt,
                                code: generatedCode,
                                timestamp: new Date().toISOString()
                            }]
                        };
                        setCurrentProject(updatedProject);
                        await saveProject(updatedProject);
                    }

                    addLog('C√≥digo gerado com sucesso!', 'success');
                    setPrompt('');
                    setActiveTab('code');
                } catch (error) {
                    addLog(`Erro ao gerar c√≥digo: ${error.message}`, 'error');
                } finally {
                    setIsGenerating(false);
                }
            };

            const createNewProject = () => {
                setShowNameModal(true);
            };

            const confirmCreateProject = () => {
                if (!projectName.trim()) return;

                const newProject = {
                    id: Date.now().toString(),
                    name: projectName,
                    code: '',
                    created: new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    history: []
                };

                setCurrentProject(newProject);
                saveProject(newProject);
                setProjectName('');
                setShowNameModal(false);
                setView('editor');
                addLog(`Projeto "${newProject.name}" criado`, 'success');
            };

            const createFromTemplate = (template) => {
                setPrompt(template.prompt);
                setShowTemplates(false);
                addLog(`Template "${template.name}" carregado`, 'info');
            };

            const openProject = (project) => {
                setCurrentProject(project);
                setCode(project.code || '');
                setView('editor');
                addLog(`Projeto "${project.name}" aberto`, 'info');
            };

            const exportCode = (format = 'js') => {
                if (!code) return;
                
                let content = code;
                let filename = `${currentProject?.name || 'app'}.${format}`;
                let mimeType = 'text/javascript';

                if (format === 'txt') {
                    mimeType = 'text/plain';
                    filename = `${currentProject?.name || 'app'}.txt`;
                } else if (format === 'json') {
                    content = JSON.stringify({
                        name: currentProject?.name || 'app',
                        code: code,
                        created: currentProject?.created,
                        lastModified: currentProject?.lastModified
                    }, null, 2);
                    filename = `${currentProject?.name || 'app'}.json`;
                    mimeType = 'application/json';
                }
                
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
                addLog(`C√≥digo exportado como ${format.toUpperCase()}`, 'success');
            };

            const renderPreview = () => {
                if (!code) return (
                    <div className={`flex items-center justify-center h-full ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                        <div className="text-center">
                            <div className="text-6xl mb-4">üì±</div>
                            <p>Nenhum c√≥digo para visualizar</p>
                        </div>
                    </div>
                );

                try {
                    const previewCode = code
                        .replace(/import.*from.*;/g, '')
                        .replace(/export default App;/g, '');

                    const PreviewApp = new Function(
                        'React',
                        'useState',
                        'useEffect',
                        'View',
                        'Text',
                        'Button',
                        'TextInput',
                        'ScrollView',
                        'Image',
                        'TouchableOpacity',
                        `
                        ${previewCode}
                        return App;
                        `
                    )(
                        React,
                        useState,
                        useEffect,
                        PreviewComponents.View,
                        PreviewComponents.Text,
                        PreviewComponents.Button,
                        PreviewComponents.TextInput,
                        PreviewComponents.ScrollView,
                        PreviewComponents.Image,
                        ({ children, onPress, style }) => (
                            <div onClick={onPress} style={{ cursor: 'pointer', ...style }}>
                                {children}
                            </div>
                        )
                    );

                    return <PreviewApp />;
                } catch (error) {
                    return (
                        <div className="flex items-center justify-center h-full text-red-500 p-4">
                            <div className="text-center">
                                <p className="font-bold mb-2">‚ö†Ô∏è Erro no c√≥digo</p>
                                <p className="text-sm">{error.message}</p>
                            </div>
                        </div>
                    );
                }
            };

            const categories = ['Todos', ...new Set(TEMPLATES.map(t => t.category))];
            const filteredTemplates = TEMPLATES.filter(t => 
                (selectedCategory === 'Todos' || t.category === selectedCategory) &&
                (t.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                 t.description.toLowerCase().includes(searchTerm.toLowerCase()))
            );

            const filteredProjects = projects.filter(p =>
                p.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <div className={`min-h-screen ${darkMode ? 'bg-gray-900' : 'bg-gray-50'}`}>
                    {/* Header */}
                    <header className={darkMode ? 'gradient-bg-dark text-white shadow-lg' : 'gradient-bg text-white shadow-lg'}>
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-3">
                                    <div className="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                                        <span className="text-2xl">‚ö°</span>
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold">OpenVibe Pro</h1>
                                        <p className="text-sm opacity-90">Open Source AI App Builder</p>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-4">
                                    {currentProject && view === 'editor' && (
                                        <div className="text-right hidden md:block">
                                            <p className="font-semibold">{currentProject.name}</p>
                                            <p className="text-xs opacity-75">
                                                {new Date(currentProject.lastModified).toLocaleString()}
                                            </p>
                                        </div>
                                    )}
                                    <button
                                        onClick={toggleTheme}
                                        className="p-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition"
                                        title={darkMode ? 'Modo Claro' : 'Modo Escuro'}
                                    >
                                        {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                                    </button>
                                    <button
                                        onClick={() => setView('projects')}
                                        className="px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition"
                                    >
                                        üìÅ Projetos
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <div className="container mx-auto px-4 py-8">
                        {view === 'projects' && (
                            <div className="slide-in">
                                <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                                    <h2 className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                        Meus Projetos
                                    </h2>
                                    <div className="flex gap-2 w-full md:w-auto">
                                        <input
                                            type="text"
                                            placeholder="üîç Buscar projetos..."
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                            className={`flex-1 md:w-64 px-4 py-2 rounded-lg border ${
                                                darkMode 
                                                    ? 'bg-gray-800 border-gray-700 text-white' 
                                                    : 'bg-white border-gray-300'
                                            }`}
                                        />
                                        <button
                                            onClick={() => setShowTemplates(true)}
                                            className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition"
                                        >
                                            üìã Templates
                                        </button>
                                        <button
                                            onClick={createNewProject}
                                            className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition"
                                        >
                                            ‚ûï Novo
                                        </button>
                                    </div>
                                </div>

                                {filteredProjects.length === 0 ? (
                                    <div className="text-center py-20">
                                        <div className="text-6xl mb-4">üì±</div>
                                        <h3 className={`text-xl font-semibold mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                            {searchTerm ? 'Nenhum projeto encontrado' : 'Nenhum projeto ainda'}
                                        </h3>
                                        <p className={`mb-6 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                            {searchTerm ? 'Tente outro termo de busca' : 'Crie seu primeiro app com IA agora!'}
                                        </p>
                                        {!searchTerm && (
                                            <div className="flex gap-3 justify-center">
                                                <button
                                                    onClick={() => setShowTemplates(true)}
                                                    className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition"
                                                >
                                                    Ver Templates
                                                </button>
                                                <button
                                                    onClick={createNewProject}
                                                    className="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition"
                                                >
                                                    Criar Projeto
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredProjects.map(project => (
                                            <div
                                                key={project.id}
                                                className={`rounded-xl shadow-md hover:shadow-xl transition p-6 cursor-pointer ${
                                                    darkMode ? 'bg-gray-800' : 'bg-white'
                                                }`}
                                            >
                                                <div className="flex justify-between items-start mb-4">
                                                    <div 
                                                        className="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg flex items-center justify-center text-white text-xl"
                                                        onClick={() => openProject(project)}
                                                    >
                                                        üì±
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                duplicateProject(project);
                                                            }}
                                                            className="text-blue-500 hover:text-blue-700"
                                                            title="Duplicar"
                                                        >
                                                            üìã
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                if (confirm(`Deletar projeto "${project.name}"?`)) {
                                                                    deleteProject(project.id);
                                                                }
                                                            }}
                                                            className="text-red-500 hover:text-red-700"
                                                            title="Deletar"
                                                        >
                                                            üóëÔ∏è
                                                        </button>
                                                    </div>
                                                </div>
                                                <div onClick={() => openProject(project)}>
                                                    <h3 className={`text-lg font-bold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                        {project.name}
                                                    </h3>
                                                    <p className={`text-sm mb-4 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                                        Criado: {new Date(project.created).toLocaleDateString()}
                                                    </p>
                                                    <div className={`flex items-center justify-between text-xs ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                        <span>{project.history?.length || 0} itera√ß√µes</span>
                                                        <span>
                                                            {project.code ? `${Math.round(project.code.length / 1000)}KB` : '0KB'}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'editor' && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                {/* Left Panel */}
                                <div className="space-y-6">
                                    {/* Tabs */}
                                    <div className={`rounded-xl shadow-lg overflow-hidden ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                        <div className={`flex border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
                                            <button
                                                onClick={() => setActiveTab('prompt')}
                                                className={`flex-1 py-3 font-semibold transition ${
                                                    activeTab === 'prompt'
                                                        ? `tab-active ${darkMode ? 'text-white' : 'text-gray-800'}`
                                                        : darkMode ? 'text-gray-400' : 'text-gray-500'
                                                }`}
                                            >
                                                ‚ú® Prompt
                                            </button>
                                            <button
                                                onClick={() => setActiveTab('code')}
                                                className={`flex-1 py-3 font-semibold transition ${
                                                    activeTab === 'code'
                                                        ? `tab-active ${darkMode ? 'text-white' : 'text-gray-800'}`
                                                        : darkMode ? 'text-gray-400' : 'text-gray-500'
                                                }`}
                                            >
                                                üíª C√≥digo
                                            </button>
                                            <button
                                                onClick={() => setActiveTab('history')}
                                                className={`flex-1 py-3 font-semibold transition ${
                                                    activeTab === 'history'
                                                        ? `tab-active ${darkMode ? 'text-white' : 'text-gray-800'}`
                                                        : darkMode ? 'text-gray-400' : 'text-gray-500'
                                                }`}
                                            >
                                                üìú Hist√≥rico
                                            </button>
                                        </div>

                                        <div className="p-6">
                                            {activeTab === 'prompt' && (
                                                <div className="space-y-4">
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={() => setShowTemplates(true)}
                                                            className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition"
                                                        >
                                                            üìã Templates
                                                        </button>
                                                    </div>
                                                    <textarea
                                                        value={prompt}
                                                        onChange={(e) => setPrompt(e.target.value)}
                                                        placeholder="Descreva o app que voc√™ quer criar...&#10;&#10;Ex: Crie um app de contador com bot√µes para incrementar e decrementar"
                                                        className={`w-full h-64 p-4 border-2 rounded-lg focus:outline-none resize-none ${
                                                            darkMode
                                                                ? 'bg-gray-900 border-gray-700 text-white focus:border-purple-500'
                                                                : 'border-gray-200 focus:border-purple-500'
                                                        }`}
                                                        disabled={isGenerating}
                                                    />
                                                    <button
                                                        onClick={generateApp}
                                                        disabled={isGenerating || !prompt.trim()}
                                                        className={`w-full py-3 rounded-lg font-semibold transition ${
                                                            isGenerating || !prompt.trim()
                                                                ? 'bg-gray-300 cursor-not-allowed'
                                                                : 'bg-purple-600 hover:bg-purple-700 text-white'
                                                        }`}
                                                    >
                                                        {isGenerating ? (
                                                            <span className="flex items-center justify-center">
                                                                <span className="animate-pulse-slow mr-2">‚ö°</span>
                                                                Gerando...
                                                            </span>
                                                        ) : (
                                                            'üöÄ Gerar App com IA'
                                                        )}
                                                    </button>
                                                </div>
                                            )}

                                            {activeTab === 'code' && (
                                                <div className="space-y-4">
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={() => exportCode('js')}
                                                            disabled={!code}
                                                            className={`px-4 py-2 rounded-lg text-sm font-semibold transition ${
                                                                code
                                                                    ? 'bg-blue-500 hover:bg-blue-600 text-white'
                                                                    : 'bg-gray-300 cursor-not-allowed text-gray-500'
                                                            }`}
                                                        >
                                                            üì• .JS
                                                        </button>
                                                        <button
                                                            onClick={() => exportCode('txt')}
                                                            disabled={!code}
                                                            className={`px-4 py-2 rounded-lg text-sm font-semibold transition ${
                                                                code
                                                                    ? 'bg-green-500 hover:bg-green-600 text-white'
                                                                    : 'bg-gray-300 cursor-not-allowed text-gray-500'
                                                            }`}
                                                        >
                                                            üìÑ .TXT
                                                        </button>
                                                        <button
                                                            onClick={() => exportCode('json')}
                                                            disabled={!code}
                                                            className={`px-4 py-2 rounded-lg text-sm font-semibold transition ${
                                                                code
                                                                    ? 'bg-orange-500 hover:bg-orange-600 text-white'
                                                                    : 'bg-gray-300 cursor-not-allowed text-gray-500'
                                                            }`}
                                                        >
                                                            üì¶ .JSON
                                                        </button>
                                                    </div>
                                                    <textarea
                                                        value={code}
                                                        onChange={(e) => {
                                                            setCode(e.target.value);
                                                            if (currentProject) {
                                                                const updated = { ...currentProject, code: e.target.value };
                                                                setCurrentProject(updated);
                                                                saveProject(updated);
                                                            }
                                                        }}
                                                        className="w-full h-96 p-4 bg-gray-900 text-green-400 rounded-lg code-editor font-mono scrollbar-hide"
                                                        placeholder="// O c√≥digo gerado aparecer√° aqui..."
                                                        spellCheck={false}
                                                    />
                                                    <div className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                                        Linhas: {code.split('\n').length} | Caracteres: {code.length}
                                                    </div>
                                                </div>
                                            )}

                                            {activeTab === 'history' && (
                                                <div className="space-y-3">
                                                    {(!currentProject?.history || currentProject.history.length === 0) ? (
                                                        <p className={darkMode ? 'text-gray-400' : 'text-gray-500'}>
                                                            Nenhuma itera√ß√£o ainda
                                                        </p>
                                                    ) : (
                                                        currentProject.history.slice().reverse().map((item, i) => (
                                                            <div
                                                                key={i}
                                                                className={`p-4 rounded-lg border cursor-pointer hover:border-purple-500 transition ${
                                                                    darkMode
                                                                        ? 'bg-gray-900 border-gray-700'
                                                                        : 'bg-gray-50 border-gray-200'
                                                                }`}
                                                                onClick={() => {
                                                                    setCode(item.code);
                                                                    setActiveTab('code');
                                                                }}
                                                            >
                                                                <div className={`text-xs mb-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                    {new Date(item.timestamp).toLocaleString()}
                                                                </div>
                                                                <div className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                                                    {item.prompt}
                                                                </div>
                                                            </div>
                                                        ))
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Logs */}
                                    <div className={`rounded-xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                        <h3 className={`text-lg font-bold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                            üìä Logs
                                        </h3>
                                        <div className="h-40 overflow-y-auto space-y-2 scrollbar-hide">
                                            {logs.length === 0 ? (
                                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-400'}`}>
                                                    Nenhum log ainda...
                                                </p>
                                            ) : (
                                                logs.slice(-10).reverse().map((log, i) => (
                                                    <div
                                                        key={i}
                                                        className={`text-sm p-2 rounded ${
                                                            log.type === 'error'
                                                                ? 'bg-red-50 text-red-700 dark:bg-red-900 dark:text-red-200'
                                                                : log.type === 'success'
                                                                ? 'bg-green-50 text-green-700 dark:bg-green-900 dark:text-green-200'
                                                                : 'bg-blue-50 text-blue-700 dark:bg-blue-900 dark:text-blue-200'
                                                        }`}
                                                    >
                                                        <span className="font-mono text-xs opacity-75">
                                                            [{log.timestamp}]
                                                        </span>{' '}
                                                        {log.message}
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* Right Panel - Preview */}
                                <div className="lg:sticky lg:top-8 h-fit">
                                    <div className={`rounded-xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                        <h3 className={`text-lg font-bold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                            üì± Preview
                                        </h3>
                                        <div className="flex justify-center">
                                            <div 
                                                className={`bg-white ${darkMode ? 'phone-frame' : 'phone-frame-light'}`}
                                                style={{ width: 375, height: 667 }}
                                            >
                                                <div className="w-full h-full overflow-auto scrollbar-hide">
                                                    {renderPreview()}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Templates Modal */}
                    {showTemplates && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className={`rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden ${
                                darkMode ? 'bg-gray-800' : 'bg-white'
                            }`}>
                                <div className="p-6 border-b border-gray-200 dark:border-gray-700">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                            üìã Templates
                                        </h2>
                                        <button
                                            onClick={() => setShowTemplates(false)}
                                            className={`text-2xl ${darkMode ? 'text-gray-400 hover:text-white' : 'text-gray-500 hover:text-gray-700'}`}
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                    <div className="flex flex-wrap gap-2">
                                        {categories.map(cat => (
                                            <button
                                                key={cat}
                                                onClick={() => setSelectedCategory(cat)}
                                                className={`px-4 py-2 rounded-lg font-semibold transition ${
                                                    selectedCategory === cat
                                                        ? 'bg-purple-600 text-white'
                                                        : darkMode
                                                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                {cat}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {filteredTemplates.map(template => (
                                            <div
                                                key={template.id}
                                                onClick={() => createFromTemplate(template)}
                                                className={`template-card p-6 rounded-xl shadow-md cursor-pointer ${
                                                    darkMode 
                                                        ? 'bg-gray-700 hover:bg-gray-600' 
                                                        : 'bg-gray-50 hover:bg-gray-100'
                                                }`}
                                            >
                                                <div className="text-4xl mb-3">{template.icon}</div>
                                                <h3 className={`font-bold text-lg mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                    {template.name}
                                                </h3>
                                                <p className={`text-sm mb-3 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                                                    {template.description}
                                                </p>
                                                <span className="text-xs px-3 py-1 bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200 rounded-full">
                                                    {template.category}
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Name Modal */}
                    {showNameModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className={`rounded-xl p-8 max-w-md w-full mx-4 ${
                                darkMode ? 'bg-gray-800' : 'bg-white'
                            }`}>
                                <h2 className={`text-2xl font-bold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                    Novo Projeto
                                </h2>
                                <input
                                    type="text"
                                    value={projectName}
                                    onChange={(e) => setProjectName(e.target.value)}
                                    placeholder="Nome do projeto..."
                                    className={`w-full p-3 border-2 rounded-lg focus:outline-none mb-6 ${
                                        darkMode
                                            ? 'bg-gray-900 border-gray-700 text-white focus:border-purple-500'
                                            : 'border-gray-200 focus:border-purple-500'
                                    }`}
                                    autoFocus
                                    onKeyPress={(e) => e.key === 'Enter' && confirmCreateProject()}
                                />
                                <div className="flex space-x-3">
                                    <button
                                        onClick={() => {
                                            setShowNameModal(false);
                                            setProjectName('');
                                        }}
                                        className={`flex-1 px-6 py-3 border-2 rounded-lg font-semibold transition ${
                                            darkMode
                                                ? 'border-gray-700 text-gray-300 hover:bg-gray-700'
                                                : 'border-gray-300 text-gray-700 hover:bg-gray-50'
                                        }`}
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={confirmCreateProject}
                                        disabled={!projectName.trim()}
                                        className={`flex-1 px-6 py-3 rounded-lg font-semibold transition ${
                                            projectName.trim()
                                                ? 'bg-purple-600 hover:bg-purple-700 text-white'
                                                : 'bg-gray-300 cursor-not-allowed text-gray-500'
                                        }`}
                                    >
                                        Criar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <footer className={`mt-20 py-8 ${darkMode ? 'bg-gray-800 text-white' : 'bg-gray-800 text-white'}`}>
                        <div className="container mx-auto px-4 text-center">
                            <p className="mb-2">
                                <strong>OpenVibe Pro</strong> - Open Source AI App Builder
                            </p>
                            <p className="text-sm opacity-75">
                                Templates ‚Ä¢ Dark Mode ‚Ä¢ Multi-Export ‚Ä¢ 100% Gr√°tis
                            </p>
                            <p className="text-xs opacity-50 mt-4">
                                React + Claude API ‚Ä¢ Licen√ßa MIT ‚Ä¢ v2.0
                            </p>
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<OpenVibeProApp />, document.getElementById('root'));
    </script>
</body>
</html>