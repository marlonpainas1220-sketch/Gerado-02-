<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenVibe Studio - Professional AI App Builder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Fira+Code:wght@400;500;600&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }

        .code-font {
            font-family: 'Fira Code', monospace;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .gradient-bg-dark {
            background: linear-gradient(135deg, #1e3a8a 0%, #4c1d95 100%);
        }

        .gradient-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .gradient-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .phone-frame {
            box-shadow: 0 0 0 12px #1f2937, 0 0 0 13px #374151, 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border-radius: 40px;
        }

        .phone-frame-light {
            box-shadow: 0 0 0 12px #e5e7eb, 0 0 0 13px #d1d5db, 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .animate-pulse-slow {
            animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .CodeMirror {
            height: 500px;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            border-radius: 8px;
        }

        .version-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .component-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .component-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .tooltip {
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 4px 8px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            font-size: 12px;
            border-radius: 4px;
            white-space: nowrap;
            z-index: 1000;
        }

        .stats-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // Component Library
        const COMPONENT_LIBRARY = [
            {
                id: 'button',
                name: 'Button',
                category: 'Basic',
                icon: 'üîò',
                code: `<Button 
  title="Clique Aqui" 
  onPress={() => console.log('Pressed')}
  style={{ backgroundColor: '#667eea' }}
/>`
            },
            {
                id: 'text',
                name: 'Text',
                category: 'Basic',
                icon: 'üìù',
                code: `<Text style={{ fontSize: 18, color: '#333' }}>
  Seu texto aqui
</Text>`
            },
            {
                id: 'textinput',
                name: 'TextInput',
                category: 'Input',
                icon: '‚úèÔ∏è',
                code: `<TextInput
  placeholder="Digite algo..."
  value={value}
  onChangeText={setValue}
  style={{ padding: 12, borderWidth: 1, borderRadius: 8 }}
/>`
            },
            {
                id: 'view',
                name: 'View (Container)',
                category: 'Layout',
                icon: 'üì¶',
                code: `<View style={{ 
  flex: 1, 
  padding: 20,
  backgroundColor: '#f5f5f5' 
}}>
  {/* Seu conte√∫do aqui */}
</View>`
            },
            {
                id: 'scrollview',
                name: 'ScrollView',
                category: 'Layout',
                icon: 'üìú',
                code: `<ScrollView style={{ flex: 1 }}>
  {/* Conte√∫do rol√°vel */}
</ScrollView>`
            },
            {
                id: 'card',
                name: 'Card',
                category: 'UI',
                icon: 'üé¥',
                code: `<View style={{
  backgroundColor: 'white',
  padding: 20,
  borderRadius: 12,
  shadowColor: '#000',
  shadowOffset: { width: 0, height: 2 },
  shadowOpacity: 0.1,
  shadowRadius: 8,
  elevation: 5
}}>
  <Text style={{ fontSize: 18, fontWeight: 'bold' }}>T√≠tulo do Card</Text>
  <Text style={{ marginTop: 8, color: '#666' }}>Conte√∫do do card</Text>
</View>`
            },
            {
                id: 'header',
                name: 'Header',
                category: 'UI',
                icon: 'üìå',
                code: `<View style={{
  padding: 20,
  backgroundColor: '#667eea',
  borderBottomLeftRadius: 20,
  borderBottomRightRadius: 20
}}>
  <Text style={{ fontSize: 24, fontWeight: 'bold', color: 'white' }}>
    Meu App
  </Text>
</View>`
            },
            {
                id: 'list',
                name: 'List Item',
                category: 'UI',
                icon: 'üìã',
                code: `{items.map((item, index) => (
  <View key={index} style={{
    flexDirection: 'row',
    alignItems: 'center',
    padding: 16,
    backgroundColor: 'white',
    marginBottom: 8,
    borderRadius: 8
  }}>
    <Text style={{ flex: 1 }}>{item}</Text>
    <Button title="X" onPress={() => removeItem(index)} />
  </View>
))}`
            }
        ];

        // Templates expandidos
        const TEMPLATES = [
            {
                id: 'blank',
                name: 'App em Branco',
                category: 'B√°sico',
                icon: 'üìÑ',
                description: 'Comece do zero',
                difficulty: 'F√°cil',
                code: `import React from 'react';
import { View, Text, StyleSheet } from 'react-native';

const App = () => {
  return (
    <View style={styles.container}>
      <Text style={styles.text}>Ol√°, OpenVibe! üëã</Text>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: '#f5f5f5',
  },
  text: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#333',
  },
});

export default App;`
            },
            {
                id: 'counter',
                name: 'Contador',
                category: 'B√°sico',
                icon: 'üî¢',
                description: 'Contador simples',
                difficulty: 'F√°cil',
                prompt: 'Crie um contador com um n√∫mero grande no centro, bot√µes verde "+" para incrementar, bot√£o vermelho "-" para decrementar, e bot√£o cinza "Reset". Use cores vibrantes e design moderno.'
            },
            {
                id: 'todo',
                name: 'Lista de Tarefas',
                category: 'Produtividade',
                icon: '‚úì',
                description: 'To-Do List completo',
                difficulty: 'M√©dio',
                prompt: 'Crie um app de lista de tarefas com header roxo, input para adicionar tarefas, lista com checkbox para marcar como conclu√≠da, bot√£o para deletar, e contador de tarefas pendentes no rodap√©.'
            },
            {
                id: 'dashboard',
                name: 'Dashboard',
                category: 'UI',
                icon: 'üìä',
                description: 'Painel com estat√≠sticas',
                difficulty: 'M√©dio',
                prompt: 'Crie um dashboard com 4 cards mostrando estat√≠sticas diferentes (usu√°rios, vendas, visitas, receita), cada um com √≠cone, n√∫mero grande, e porcentagem de crescimento em verde/vermelho. Use gradientes e sombras.'
            },
            {
                id: 'profile',
                name: 'Perfil de Usu√°rio',
                category: 'UI',
                icon: 'üë§',
                description: 'Tela de perfil',
                difficulty: 'M√©dio',
                prompt: 'Crie uma tela de perfil com foto circular no topo, nome do usu√°rio, bio, e 4 cards com estat√≠sticas (posts, seguidores, seguindo, curtidas). Bot√£o "Editar Perfil" no final. Design moderno e clean.'
            },
            {
                id: 'login',
                name: 'Tela de Login',
                category: 'Auth',
                icon: 'üîê',
                description: 'Login moderno',
                difficulty: 'M√©dio',
                prompt: 'Crie tela de login com logo no topo, inputs para email e senha com √≠cones, bot√£o "Entrar" roxo grande, link "Esqueci a senha", e link "Criar conta". Use gradiente de fundo e design moderno.'
            },
            {
                id: 'settings',
                name: 'Configura√ß√µes',
                category: 'UI',
                icon: '‚öôÔ∏è',
                description: 'Menu de configura√ß√µes',
                difficulty: 'M√©dio',
                prompt: 'Crie menu de configura√ß√µes com se√ß√µes: Conta (email, senha), Prefer√™ncias (notifica√ß√µes, idioma, tema), e Sobre (vers√£o, termos, privacidade). Cada item com √≠cone e seta. Header com t√≠tulo e bot√£o voltar.'
            },
            {
                id: 'chat',
                name: 'Interface de Chat',
                category: 'Comunica√ß√£o',
                icon: 'üí¨',
                description: 'App de mensagens',
                difficulty: 'Dif√≠cil',
                prompt: 'Crie interface de chat com lista de mensagens alternando esquerda/direita, bolhas arredondadas, input fixo no rodap√© com bot√£o enviar, header com nome do contato e foto. Use cores diferentes para enviadas/recebidas.'
            }
        ];

        // Preview Components
        const PreviewComponents = {
            View: ({ children, style = {} }) => (
                <div style={{ display: 'flex', flexDirection: 'column', ...style }}>
                    {children}
                </div>
            ),
            Text: ({ children, style = {} }) => (
                <span style={{ fontSize: 16, color: '#000', ...style }}>
                    {children}
                </span>
            ),
            Button: ({ title, onPress, style = {} }) => (
                <button
                    onClick={onPress}
                    style={{
                        padding: '12px 24px',
                        backgroundColor: '#667eea',
                        color: 'white',
                        border: 'none',
                        borderRadius: 8,
                        cursor: 'pointer',
                        fontSize: 16,
                        fontWeight: 500,
                        ...style
                    }}
                >
                    {title}
                </button>
            ),
            TextInput: ({ placeholder, value, onChangeText, style = {} }) => (
                <input
                    type="text"
                    placeholder={placeholder}
                    value={value}
                    onChange={(e) => onChangeText?.(e.target.value)}
                    style={{
                        padding: '12px',
                        border: '1px solid #d1d5db',
                        borderRadius: 8,
                        fontSize: 16,
                        width: '100%',
                        ...style
                    }}
                />
            ),
            ScrollView: ({ children, style = {} }) => (
                <div style={{ overflow: 'auto', ...style }}>
                    {children}
                </div>
            ),
            Image: ({ source, style = {} }) => (
                <img
                    src={source?.uri || source}
                    style={{ maxWidth: '100%', ...style }}
                    alt=""
                />
            )
        };

        const OpenVibeStudio = () => {
            const [projects, setProjects] = useState([]);
            const [currentProject, setCurrentProject] = useState(null);
            const [prompt, setPrompt] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [view, setView] = useState('projects');
            const [code, setCode] = useState('');
            const [logs, setLogs] = useState([]);
            const [projectName, setProjectName] = useState('');
            const [showNameModal, setShowNameModal] = useState(false);
            const [showTemplates, setShowTemplates] = useState(false);
            const [showComponents, setShowComponents] = useState(false);
            const [selectedCategory, setSelectedCategory] = useState('Todos');
            const [darkMode, setDarkMode] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [activeTab, setActiveTab] = useState('prompt');
            const [showVersions, setShowVersions] = useState(false);
            const editorRef = useRef(null);
            const codeMirrorRef = useRef(null);

            useEffect(() => {
                loadProjects();
                loadTheme();
            }, []);

            useEffect(() => {
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [darkMode]);

            useEffect(() => {
                if (editorRef.current && !codeMirrorRef.current && activeTab === 'code') {
                    codeMirrorRef.current = CodeMirror.fromTextArea(editorRef.current, {
                        mode: 'javascript',
                        theme: darkMode ? 'monokai' : 'default',
                        lineNumbers: true,
                        lineWrapping: true,
                        autoCloseBrackets: true,
                        matchBrackets: true,
                    });
                    
                    codeMirrorRef.current.setValue(code);
                    codeMirrorRef.current.on('change', (cm) => {
                        setCode(cm.getValue());
                    });
                }

                if (codeMirrorRef.current) {
                    codeMirrorRef.current.setOption('theme', darkMode ? 'monokai' : 'default');
                }
            }, [activeTab, darkMode]);

            const loadTheme = async () => {
                try {
                    const result = await window.storage.get('theme');
                    if (result?.value === 'dark') {
                        setDarkMode(true);
                    }
                } catch (error) {
                    console.log('No theme saved');
                }
            };

            const toggleTheme = async () => {
                const newMode = !darkMode;
                setDarkMode(newMode);
                try {
                    await window.storage.set('theme', newMode ? 'dark' : 'light');
                } catch (error) {
                    console.log('Could not save theme');
                }
            };

            const loadProjects = async () => {
                try {
                    const result = await window.storage.list('project:');
                    if (result?.keys) {
                        const projectPromises = result.keys.map(async (key) => {
                            const data = await window.storage.get(key);
                            return data ? JSON.parse(data.value) : null;
                        });
                        const loadedProjects = await Promise.all(projectPromises);
                        setProjects(loadedProjects.filter(p => p !== null));
                    }
                } catch (error) {
                    console.log('Nenhum projeto salvo ainda');
                }
            };

            const saveProject = async (project) => {
                try {
                    await window.storage.set(
                        `project:${project.id}`,
                        JSON.stringify(project)
                    );
                    await loadProjects();
                } catch (error) {
                    addLog('Erro ao salvar projeto', 'error');
                }
            };

            const deleteProject = async (projectId) => {
                try {
                    await window.storage.delete(`project:${projectId}`);
                    await loadProjects();
                    if (currentProject?.id === projectId) {
                        setCurrentProject(null);
                        setView('projects');
                    }
                    addLog('Projeto deletado com sucesso', 'success');
                } catch (error) {
                    addLog('Erro ao deletar projeto', 'error');
                }
            };

            const duplicateProject = async (project) => {
                const newProject = {
                    ...project,
                    id: Date.now().toString(),
                    name: `${project.name} (C√≥pia)`,
                    created: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                };
                await saveProject(newProject);
                addLog(`Projeto "${newProject.name}" duplicado`, 'success');
            };

            const createVersion = () => {
                if (!currentProject || !code) return;
                
                const version = {
                    id: Date.now().toString(),
                    name: `v${(currentProject.versions?.length || 0) + 1}.0`,
                    code: code,
                    timestamp: new Date().toISOString(),
                    message: prompt || 'Vers√£o salva manualmente'
                };

                const updatedProject = {
                    ...currentProject,
                    versions: [...(currentProject.versions || []), version]
                };

                setCurrentProject(updatedProject);
                saveProject(updatedProject);
                addLog(`Vers√£o ${version.name} criada`, 'success');
            };

            const loadVersion = (version) => {
                setCode(version.code);
                if (codeMirrorRef.current) {
                    codeMirrorRef.current.setValue(version.code);
                }
                addLog(`Vers√£o ${version.name} carregada`, 'info');
                setShowVersions(false);
                setActiveTab('code');
            };

            const addLog = (message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString();
                setLogs(prev => [...prev, { message, type, timestamp }]);
            };

            const generateApp = async () => {
                if (!prompt.trim()) return;

                setIsGenerating(true);
                addLog('Gerando c√≥digo com IA...', 'info');

                try {
                    const systemPrompt = `Voc√™ √© um expert em React Native. Gere c√≥digo React Native completo e funcional baseado no prompt do usu√°rio.

Regras importantes:
1. Use APENAS componentes React Native nativos: View, Text, Button, TextInput, ScrollView, Image, TouchableOpacity
2. Use hooks do React: useState, useEffect quando necess√°rio
3. O c√≥digo deve ser limpo, bem estruturado e comentado
4. Retorne APENAS o c√≥digo JavaScript, sem explica√ß√µes
5. O c√≥digo deve come√ßar com: const App = () => {
6. Termine com: export default App;
7. Use StyleSheet para estilos organizados
8. Fa√ßa o app ser visualmente atraente e funcional
9. Use cores vibrantes e design moderno
10. Adicione tratamento de erros quando apropriado`;

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 4000,
                            messages: [
                                {
                                    role: 'user',
                                    content: `${systemPrompt}\n\nPrompt do usu√°rio: ${prompt}\n\nGere o c√≥digo React Native completo:`
                                }
                            ]
                        })
                    });

                    const data = await response.json();
                    let generatedCode = data.content[0].text;

                    generatedCode = generatedCode.replace(/```javascript\n?/g, '');
                    generatedCode = generatedCode.replace(/```\n?/g, '');
                    generatedCode = generatedCode.trim();

                    setCode(generatedCode);
                    
                    if (codeMirrorRef.current) {
                        codeMirrorRef.current.setValue(generatedCode);
                    }
                    
                    if (currentProject) {
                        const updatedProject = {
                            ...currentProject,
                            code: generatedCode,
                            lastModified: new Date().toISOString(),
                            history: [...(currentProject.history || []), {
                                prompt,
                                code: generatedCode,
                                timestamp: new Date().toISOString()
                            }]
                        };
                        setCurrentProject(updatedProject);
                        await saveProject(updatedProject);
                    }

                    addLog('C√≥digo gerado com sucesso!', 'success');
                    setPrompt('');
                    setActiveTab('code');
                } catch (error) {
                    addLog(`Erro ao gerar c√≥digo: ${error.message}`, 'error');
                } finally {
                    setIsGenerating(false);
                }
            };

            const createNewProject = () => {
                setShowNameModal(true);
            };

            const confirmCreateProject = () => {
                if (!projectName.trim()) return;

                const newProject = {
                    id: Date.now().toString(),
                    name: projectName,
                    code: '',
                    created: new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    history: [],
                    versions: []
                };

                setCurrentProject(newProject);
                saveProject(newProject);
                setProjectName('');
                setShowNameModal(false);
                setView('editor');
                addLog(`Projeto "${newProject.name}" criado`, 'success');
            };

            const createFromTemplate = (template) => {
                if (template.code) {
                    setCode(template.code);
                    if (codeMirrorRef.current) {
                        codeMirrorRef.current.setValue(template.code);
                    }
                    setShowTemplates(false);
                    setActiveTab('code');
                    addLog(`Template "${template.name}" carregado`, 'info');
                } else if (template.prompt) {
                    setPrompt(template.prompt);
                    setShowTemplates(false);
                    addLog(`Template "${template.name}" carregado`, 'info');
                }
            };

            const insertComponent = (component) => {
                const currentCode = codeMirrorRef.current ? codeMirrorRef.current.getValue() : code;
                const newCode = currentCode + '\n\n' + component.code;
                setCode(newCode);
                if (codeMirrorRef.current) {
                    codeMirrorRef.current.setValue(newCode);
                }
                setShowComponents(false);
                addLog(`Componente "${component.name}" inserido`, 'success');
            };

            const openProject = (project) => {
                setCurrentProject(project);
                setCode(project.code || '');
                setView('editor');
                addLog(`Projeto "${project.name}" aberto`, 'info');
            };

            const exportCode = (format = 'js') => {
                if (!code) return;
                
                let content = code;
                let filename = `${currentProject?.name || 'app'}.${format}`;
                let mimeType = 'text/javascript';

                if (format === 'txt') {
                    mimeType = 'text/plain';
                } else if (format === 'json') {
                    content = JSON.stringify({
                        name: currentProject?.name || 'app',
                        code: code,
                        created: currentProject?.created,
                        lastModified: currentProject?.lastModified,
                        versions: currentProject?.versions || []
                    }, null, 2);
                    mimeType = 'application/json';
                }
                
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
                addLog(`C√≥digo exportado como ${format.toUpperCase()}`, 'success');
            };

            const renderPreview = () => {
                if (!code) return (
                    <div className={`flex flex-col items-center justify-center h-full ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                        <div className="text-6xl mb-4">üì±</div>
                        <p className="text-center px-4">
                            Nenhum c√≥digo para visualizar
                            <br/>
                            <span className="text-sm">Gere c√≥digo com IA ou use um template</span>
                        </p>
                    </div>
                );

                try {
                    const previewCode = code
                        .replace(/import.*from.*;/g, '')
                        .replace(/export default App;/g, '');

                    const PreviewApp = new Function(
                        'React',
                        'useState',
                        'useEffect',
                        'View',
                        'Text',
                        'Button',
                        'TextInput',
                        'ScrollView',
                        'Image',
                        'TouchableOpacity',
                        `
                        ${previewCode}
                        return App;
                        `
                    )(
                        React,
                        useState,
                        useEffect,
                        PreviewComponents.View,
                        PreviewComponents.Text,
                        PreviewComponents.Button,
                        PreviewComponents.TextInput,
                        PreviewComponents.ScrollView,
                        PreviewComponents.Image,
                        ({ children, onPress, style }) => (
                            <div onClick={onPress} style={{ cursor: 'pointer', ...style }}>
                                {children}
                            </div>
                        )
                    );

                    return <PreviewApp />;
                } catch (error) {
                    return (
                        <div className="flex items-center justify-center h-full text-red-500 p-4">
                            <div className="text-center">
                                <p className="font-bold mb-2 text-2xl">‚ö†Ô∏è</p>
                                <p className="font-bold mb-2">Erro no c√≥digo</p>
                                <p className="text-sm bg-red-50 dark:bg-red-900 p-3 rounded">{error.message}</p>
                            </div>
                        </div>
                    );
                }
            };

            const projectStats = useMemo(() => {
                if (!currentProject) return null;
                return {
                    lines: code.split('\n').length,
                    chars: code.length,
                    iterations: currentProject.history?.length || 0,
                    versions: currentProject.versions?.length || 0,
                    size: `${Math.round(code.length / 1024)}KB`
                };
            }, [currentProject, code]);

            const categories = ['Todos', ...new Set(TEMPLATES.map(t => t.category))];
            const componentCategories = ['Todos', ...new Set(COMPONENT_LIBRARY.map(c => c.category))];
            
            const filteredTemplates = TEMPLATES.filter(t => 
                (selectedCategory === 'Todos' || t.category === selectedCategory) &&
                (t.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                 t.description.toLowerCase().includes(searchTerm.toLowerCase()))
            );

            const filteredComponents = COMPONENT_LIBRARY.filter(c =>
                (selectedCategory === 'Todos' || c.category === selectedCategory)
            );

            const filteredProjects = projects.filter(p =>
                p.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <div className={`min-h-screen ${darkMode ? 'bg-gray-900' : 'bg-gray-50'}`}>
                    {/* Header */}
                    <header className={darkMode ? 'gradient-bg-dark text-white shadow-lg' : 'gradient-bg text-white shadow-lg'}>
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-3">
                                    <div className="w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-lg">
                                        <span className="text-3xl">‚ö°</span>
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold">OpenVibe Studio</h1>
                                        <p className="text-sm opacity-90">Professional AI App Builder</p>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-4">
                                    {currentProject && view === 'editor' && projectStats && (
                                        <div className="hidden lg:flex items-center space-x-6 text-sm">
                                            <div className="text-center">
                                                <div className="font-bold text-lg">{projectStats.lines}</div>
                                                <div className="opacity-75 text-xs">linhas</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="font-bold text-lg">{projectStats.iterations}</div>
                                                <div className="opacity-75 text-xs">itera√ß√µes</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="font-bold text-lg">{projectStats.versions}</div>
                                                <div className="opacity-75 text-xs">vers√µes</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="font-bold text-lg">{projectStats.size}</div>
                                                <div className="opacity-75 text-xs">tamanho</div>
                                            </div>
                                        </div>
                                    )}
                                    <button
                                        onClick={toggleTheme}
                                        className="p-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition tooltip"
                                        data-tooltip={darkMode ? 'Modo Claro' : 'Modo Escuro'}
                                    >
                                        {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                                    </button>
                                    <button
                                        onClick={() => setView('projects')}
                                        className="px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition"
                                    >
                                        üìÅ Projetos
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <div className="container mx-auto px-4 py-8">
                        {view === 'projects' && (
                            <div className="slide-in">
                                <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                                    <div>
                                        <h2 className={`text-3xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                            Meus Projetos
                                        </h2>
                                        <p className={darkMode ? 'text-gray-400' : 'text-gray-600'}>
                                            {projects.length} projeto{projects.length !== 1 ? 's' : ''} criado{projects.length !== 1 ? 's' : ''}
                                        </p>
                                    </div>
                                    <div className="flex gap-2 w-full md:w-auto flex-wrap">
                                        <input
                                            type="text"
                                            placeholder="üîç Buscar..."
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                            className={`flex-1 md:w-48 px-4 py-2 rounded-lg border ${
                                                darkMode 
                                                    ? 'bg-gray-800 border-gray-700 text-white' 
                                                    : 'bg-white border-gray-300'
                                            }`}
                                        />
                                        <button
                                            onClick={() => setShowTemplates(true)}
                                            className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition"
                                        >
                                            üìã Templates
                                        </button>
                                        <button
                                            onClick={createNewProject}
                                            className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition"
                                        >
                                            ‚ûï Novo Projeto
                                        </button>
                                    </div>
                                </div>

                                {filteredProjects.length === 0 ? (
                                    <div className="text-center py-20">
                                        <div className="text-7xl mb-4">üöÄ</div>
                                        <h3 className={`text-2xl font-bold mb-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                            {searchTerm ? 'Nenhum projeto encontrado' : 'Comece Criando um Projeto'}
                                        </h3>
                                        <p className={`mb-8 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                            {searchTerm ? 'Tente outro termo de busca' : 'Use templates prontos ou crie do zero com IA'}
                                        </p>
                                        {!searchTerm && (
                                            <div className="flex gap-4 justify-center flex-wrap">
                                                <button
                                                    onClick={() => setShowTemplates(true)}
                                                    className="px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl font-bold transition shadow-lg"
                                                >
                                                    üìã Ver Templates
                                                </button>
                                                <button
                                                    onClick={createNewProject}
                                                    className="px-8 py-4 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-xl font-bold transition shadow-lg"
                                                >
                                                    ‚ö° Criar com IA
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredProjects.map(project => {
                                            const stats = {
                                                lines: project.code?.split('\n').length || 0,
                                                size: Math.round((project.code?.length || 0) / 1024),
                                                iterations: project.history?.length || 0,
                                                versions: project.versions?.length || 0
                                            };
                                            
                                            return (
                                                <div
                                                    key={project.id}
                                                    className={`rounded-xl shadow-md hover:shadow-2xl transition-all p-6 cursor-pointer transform hover:-translate-y-1 ${
                                                        darkMode ? 'bg-gray-800' : 'bg-white'
                                                    }`}
                                                >
                                                    <div className="flex justify-between items-start mb-4">
                                                        <div 
                                                            className="w-14 h-14 bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl flex items-center justify-center text-white text-2xl shadow-lg"
                                                            onClick={() => openProject(project)}
                                                        >
                                                            üì±
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    duplicateProject(project);
                                                                }}
                                                                className="p-2 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900 rounded-lg transition tooltip"
                                                                data-tooltip="Duplicar"
                                                            >
                                                                üìã
                                                            </button>
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    if (confirm(`Deletar "${project.name}"?`)) {
                                                                        deleteProject(project.id);
                                                                    }
                                                                }}
                                                                className="p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900 rounded-lg transition tooltip"
                                                                data-tooltip="Deletar"
                                                            >
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div onClick={() => openProject(project)}>
                                                        <h3 className={`text-lg font-bold mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                            {project.name}
                                                        </h3>
                                                        <p className={`text-sm mb-4 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                                            Criado: {new Date(project.created).toLocaleDateString()}
                                                        </p>
                                                        <div className="grid grid-cols-4 gap-2 text-center">
                                                            <div className={`p-2 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                                <div className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Linhas</div>
                                                                <div className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.lines}</div>
                                                            </div>
                                                            <div className={`p-2 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                                <div className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>KB</div>
                                                                <div className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.size}</div>
                                                            </div>
                                                            <div className={`p-2 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                                <div className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Iter.</div>
                                                                <div className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.iterations}</div>
                                                            </div>
                                                            <div className={`p-2 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                                <div className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Ver.</div>
                                                                <div className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.versions}</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'editor' && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                {/* Left Panel */}
                                <div className="space-y-6">
                                    {/* Project Info */}
                                    {currentProject && (
                                        <div className={`rounded-xl shadow-lg p-6 gradient-card text-white`}>
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <h3 className="text-2xl font-bold mb-2">{currentProject.name}</h3>
                                                    <p className="text-sm opacity-90">
                                                        Modificado: {new Date(currentProject.lastModified).toLocaleString()}
                                                    </p>
                                                </div>
                                                <button
                                                    onClick={createVersion}
                                                    disabled={!code}
                                                    className={`px-4 py-2 rounded-lg font-semibold transition ${
                                                        code
                                                            ? 'bg-white text-purple-600 hover:bg-opacity-90'
                                                            : 'bg-white bg-opacity-20 cursor-not-allowed'
                                                    }`}
                                                >
                                                    üíæ Salvar Vers√£o
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    {/* Tabs */}
                                    <div className={`rounded-xl shadow-lg overflow-hidden ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                        <div className={`flex border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
                                            <button
                                                onClick={() => setActiveTab('prompt')}
                                                className={`flex-1 py-3 font-semibold transition flex items-center justify-center gap-2 ${
                                                    activeTab === 'prompt'
                                                        ? `border-b-4 border-purple-600 ${darkMode ? 'text-white' : 'text-gray-800'}`
                                                        : darkMode ? 'text-gray-400 hover:text-gray-300' : 'text-gray-500 hover:text-gray-700'
                                                }`}
                                            >
                                                <span>‚ú®</span> Prompt
                                            </button>
                                            <button
                                                onClick={() => setActiveTab('code')}
                                                className={`flex-1 py-3 font-semibold transition flex items-center justify-center gap-2 ${
                                                    activeTab === 'code'
                                                        ? `border-b-4 border-purple-600 ${darkMode ? 'text-white' : 'text-gray-800'}`
                                                        : darkMode ? 'text-gray-400 hover:text-gray-300' : 'text-gray-500 hover:text-gray-700'
                                                }`}
                                            >
                                                <span>üíª</span> C√≥digo
                                            </button>
                                            <button
                                                onClick={() => setActiveTab('history')}
                                                className={`flex-1 py-3 font-semibold transition flex items-center justify-center gap-2 ${
                                                    activeTab === 'history'
                                                        ? `border-b-4 border-purple-600 ${darkMode ? 'text-white' : 'text-gray-800'}`
                                                        : darkMode ? 'text-gray-400 hover:text-gray-300' : 'text-gray-500 hover:text-gray-700'
                                                }`}
                                            >
                                                <span>üìú</span> Hist√≥rico
                                                {currentProject?.history?.length > 0 && (
                                                    <span className="px-2 py-0.5 bg-purple-600 text-white text-xs rounded-full">
                                                        {currentProject.history.length}
                                                    </span>
                                                )}
                                            </button>
                                        </div>

                                        <div className="p-6">
                                            {activeTab === 'prompt' && (
                                                <div className="space-y-4 fade-in">
                                                    <div className="flex gap-2 flex-wrap">
                                                        <button
                                                            onClick={() => setShowTemplates(true)}
                                                            className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition"
                                                        >
                                                            üìã Templates
                                                        </button>
                                                        <button
                                                            onClick={() => setShowComponents(true)}
                                                            className="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition"
                                                        >
                                                            üß© Componentes
                                                        </button>
                                                        {currentProject?.versions?.length > 0 && (
                                                            <button
                                                                onClick={() => setShowVersions(true)}
                                                                className="px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg text-sm font-semibold transition"
                                                            >
                                                                üïê Vers√µes ({currentProject.versions.length})
                                                            </button>
                                                        )}
                                                    </div>
                                                    <textarea
                                                        value={prompt}
                                                        onChange={(e) => setPrompt(e.target.value)}
                                                        placeholder="Descreva o app que voc√™ quer criar...&#10;&#10;Ex: Crie um app de contador com bot√µes para incrementar e decrementar&#10;&#10;Seja espec√≠fico sobre cores, layout e funcionalidades!"
                                                        className={`w-full h-72 p-4 border-2 rounded-lg focus:outline-none resize-none ${
                                                            darkMode
                                                                ? 'bg-gray-900 border-gray-700 text-white placeholder-gray-500 focus:border-purple-500'
                                                                : 'border-gray-200 placeholder-gray-400 focus:border-purple-500'
                                                        }`}
                                                        disabled={isGenerating}
                                                    />
                                                    <button
                                                        onClick={generateApp}
                                                        disabled={isGenerating || !prompt.trim()}
                                                        className={`w-full py-4 rounded-lg font-bold transition text-lg shadow-lg ${
                                                            isGenerating || !prompt.trim()
                                                                ? 'bg-gray-300 cursor-not-allowed text-gray-500'
                                                                : 'bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white'
                                                        }`}
                                                    >
                                                        {isGenerating ? (
                                                            <span className="flex items-center justify-center gap-2">
                                                                <span className="animate-pulse-slow">‚ö°</span>
                                                                Gerando c√≥digo m√°gico...
                                                            </span>
                                                        ) : (
                                                            <span className="flex items-center justify-center gap-2">
                                                                üöÄ Gerar App com IA
                                                            </span>
                                                        )}
                                                    </button>
                                                </div>
                                            )}

                                            {activeTab === 'code' && (
                                                <div className="space-y-4 fade-in">
                                                    <div className="flex gap-2 flex-wrap">
                                                        <button
                                                            onClick={() => exportCode('js')}
                                                            disabled={!code}
                                                            className={`px-4 py-2 rounded-lg text-sm font-semibold transition ${
                                                                code
                                                                    ? 'bg-blue-500 hover:bg-blue-600 text-white'
                                                                    : 'bg-gray-300 cursor-not-allowed text-gray-500'
                                                            }`}
                                                        >
                                                            üì• .JS
                                                        </button>
                                                        <button
                                                            onClick={() => exportCode('txt')}
                                                            disabled={!code}
                                                            className={`px-4 py-2 rounded-lg text-sm font-semibold transition ${
                                                                code
                                                                    ? 'bg-green-500 hover:bg-green-600 text-white'
                                                                    : 'bg-gray-300 cursor-not-allowed text-gray-500'
                                                            }`}
                                                        >
                                                            üìÑ .TXT
                                                        </button>
                                                        <button
                                                            onClick={() => exportCode('json')}
                                                            disabled={!code}
                                                            className={`px-4 py-2 rounded-lg text-sm font-semibold transition ${
                                                                code
                                                                    ? 'bg-orange-500 hover:bg-orange-600 text-white'
                                                                    : 'bg-gray-300 cursor-not-allowed text-gray-500'
                                                            }`}
                                                        >
                                                            üì¶ .JSON
                                                        </button>
                                                        <button
                                                            onClick={() => setShowComponents(true)}
                                                            className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-semibold transition"
                                                        >
                                                            ‚ûï Inserir Componente
                                                        </button>
                                                    </div>
                                                    <div>
                                                        <textarea
                                                            ref={editorRef}
                                                            className="hidden"
                                                            defaultValue={code}
                                                        />
                                                    </div>
                                                    {projectStats && (
                                                        <div className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'} flex gap-4`}>
                                                            <span>üìè {projectStats.lines} linhas</span>
                                                            <span>üìù {projectStats.chars} caracteres</span>
                                                            <span>üíæ {projectStats.size}</span>
                                                        </div>
                                                    )}
                                                </div>
                                            )}

                                            {activeTab === 'history' && (
                                                <div className="space-y-3 max-h-96 overflow-y-auto scrollbar-hide fade-in">
                                                    {(!currentProject?.history || currentProject.history.length === 0) ? (
                                                        <div className="text-center py-12">
                                                            <div className="text-4xl mb-3">üìú</div>
                                                            <p className={darkMode ? 'text-gray-400' : 'text-gray-500'}>
                                                                Nenhuma itera√ß√£o ainda
                                                            </p>
                                                            <p className={`text-sm mt-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                Gere c√≥digo com IA para come√ßar
                                                            </p>
                                                        </div>
                                                    ) : (
                                                        currentProject.history.slice().reverse().map((item, i) => (
                                                            <div
                                                                key={i}
                                                                className={`p-4 rounded-lg border cursor-pointer hover:border-purple-500 transition ${
                                                                    darkMode
                                                                        ? 'bg-gray-900 border-gray-700 hover:bg-gray-850'
                                                                        : 'bg-gray-50 border-gray-200 hover:bg-gray-100'
                                                                }`}
                                                                onClick={() => {
                                                                    setCode(item.code);
                                                                    if (codeMirrorRef.current) {
                                                                        codeMirrorRef.current.setValue(item.code);
                                                                    }
                                                                    setActiveTab('code');
                                                                }}
                                                            >
                                                                <div className="flex justify-between items-start mb-2">
                                                                    <div className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                        {new Date(item.timestamp).toLocaleString()}
                                                                    </div>
                                                                    <div className="text-xs px-2 py-1 bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200 rounded">
                                                                        #{currentProject.history.length - i}
                                                                    </div>
                                                                </div>
                                                                <div className={`text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                                                    {item.prompt}
                                                                </div>
                                                                <div className={`text-xs mt-2 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                    {item.code.split('\n').length} linhas ‚Ä¢ {Math.round(item.code.length / 1024)}KB
                                                                </div>
                                                            </div>
                                                        ))
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Logs */}
                                    <div className={`rounded-xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className={`text-lg font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                üìä Activity Log
                                            </h3>
                                            {logs.length > 0 && (
                                                <button
                                                    onClick={() => setLogs([])}
                                                    className={`text-xs px-3 py-1 rounded ${
                                                        darkMode
                                                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                                    } transition`}
                                                >
                                                    Limpar
                                                </button>
                                            )}
                                        </div>
                                        <div className="h-40 overflow-y-auto space-y-2 scrollbar-hide">
                                            {logs.length === 0 ? (
                                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-400'}`}>
                                                    Aguardando atividade...
                                                </p>
                                            ) : (
                                                logs.slice(-10).reverse().map((log, i) => (
                                                    <div
                                                        key={i}
                                                        className={`text-sm p-3 rounded-lg ${
                                                            log.type === 'error'
                                                                ? 'bg-red-50 text-red-700 dark:bg-red-900 dark:text-red-200 border border-red-200 dark:border-red-800'
                                                                : log.type === 'success'
                                                                ? 'bg-green-50 text-green-700 dark:bg-green-900 dark:text-green-200 border border-green-200 dark:border-green-800'
                                                                : 'bg-blue-50 text-blue-700 dark:bg-blue-900 dark:text-blue-200 border border-blue-200 dark:border-blue-800'
                                                        }`}
                                                    >
                                                        <div className="flex items-start gap-2">
                                                            <span className="text-base">
                                                                {log.type === 'error' ? '‚ùå' : log.type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'}
                                                            </span>
                                                            <div className="flex-1">
                                                                <span className="font-mono text-xs opacity-75">
                                                                    [{log.timestamp}]
                                                                </span>{' '}
                                                                <span className="font-medium">{log.message}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* Right Panel - Preview */}
                                <div className="lg:sticky lg:top-8 h-fit">
                                    <div className={`rounded-xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className={`text-lg font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                üì± Live Preview
                                            </h3>
                                            <div className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                                code 
                                                    ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200'
                                                    : 'bg-gray-100 text-gray-500 dark:bg-gray-700 dark:text-gray-400'
                                            }`}>
                                                {code ? '‚óè ONLINE' : '‚óã OFFLINE'}
                                            </div>
                                        </div>
                                        <div className="flex justify-center">
                                            <div 
                                                className={`bg-white ${darkMode ? 'phone-frame' : 'phone-frame-light'}`}
                                                style={{ width: 375, height: 667 }}
                                            >
                                                <div className="w-full h-full overflow-auto scrollbar-hide">
                                                    {renderPreview()}
                                                </div>
                                            </div>
                                        </div>
                                        {code && (
                                            <div className="mt-6 text-center">
                                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                                    üí° Preview em tempo real do seu app
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Templates Modal */}
                    {showTemplates && (
                        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                            <div className={`rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl ${
                                darkMode ? 'bg-gray-800' : 'bg-white'
                            }`}>
                                <div className="p-6 border-b border-gray-200 dark:border-gray-700">
                                    <div className="flex justify-between items-center mb-4">
                                        <div>
                                            <h2 className={`text-3xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                üìã Templates Prontos
                                            </h2>
                                            <p className={`text-sm mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                                {filteredTemplates.length} templates dispon√≠veis
                                            </p>
                                        </div>
                                        <button
                                            onClick={() => {
                                                setShowTemplates(false);
                                                setSelectedCategory('Todos');
                                            }}
                                            className={`text-3xl ${darkMode ? 'text-gray-400 hover:text-white' : 'text-gray-500 hover:text-gray-700'} transition`}
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                    <div className="flex flex-wrap gap-2">
                                        {categories.map(cat => (
                                            <button
                                                key={cat}
                                                onClick={() => setSelectedCategory(cat)}
                                                className={`px-4 py-2 rounded-lg font-semibold transition ${
                                                    selectedCategory === cat
                                                        ? 'bg-purple-600 text-white shadow-lg'
                                                        : darkMode
                                                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                {cat}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {filteredTemplates.map(template => (
                                            <div
                                                key={template.id}
                                                onClick={() => createFromTemplate(template)}
                                                className={`component-card p-6 rounded-xl shadow-lg cursor-pointer ${
                                                    darkMode 
                                                        ? 'bg-gray-700 hover:bg-gray-600' 
                                                        : 'bg-gray-50 hover:bg-gray-100'
                                                }`}
                                            >
                                                <div className="text-5xl mb-4">{template.icon}</div>
                                                <h3 className={`font-bold text-xl mb-2 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                    {template.name}
                                                </h3>
                                                <p className={`text-sm mb-4 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                                                    {template.description}
                                                </p>
                                                <div className="flex items-center justify-between">
                                                    <span className="text-xs px-3 py-1 bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200 rounded-full font-semibold">
                                                        {template.category}
                                                    </span>
                                                    {template.difficulty && (
                                                        <span className={`text-xs px-3 py-1 rounded-full font-semibold ${
                                                            template.difficulty === 'F√°cil' 
                                                                ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200'
                                                                : template.difficulty === 'M√©dio'
                                                                ? 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-200'
                                                                : 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-200'
                                                        }`}>
                                                            {template.difficulty}
                                                        </span>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Components Modal */}
                    {showComponents && (
                        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                            <div className={`rounded-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden shadow-2xl ${
                                darkMode ? 'bg-gray-800' : 'bg-white'
                            }`}>
                                <div className="p-6 border-b border-gray-200 dark:border-gray-700">
                                    <div className="flex justify-between items-center mb-4">
                                        <div>
                                            <h2 className={`text-3xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                üß© Biblioteca de Componentes
                                            </h2>
                                            <p className={`text-sm mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                                Clique para inserir no c√≥digo
                                            </p>
                                        </div>
                                        <button
                                            onClick={() => {
                                                setShowComponents(false);
                                                setSelectedCategory('Todos');
                                            }}
                                            className={`text-3xl ${darkMode ? 'text-gray-400 hover:text-white' : 'text-gray-500 hover:text-gray-700'} transition`}
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                    <div className="flex flex-wrap gap-2">
                                        {componentCategories.map(cat => (
                                            <button
                                                key={cat}
                                                onClick={() => setSelectedCategory(cat)}
                                                className={`px-4 py-2 rounded-lg font-semibold transition ${
                                                    selectedCategory === cat
                                                        ? 'bg-green-600 text-white shadow-lg'
                                                        : darkMode
                                                            ? 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                {cat}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {filteredComponents.map(component => (
                                            <div
                                                key={component.id}
                                                onClick={() => insertComponent(component)}
                                                className={`component-card p-6 rounded-xl shadow-lg cursor-pointer ${
                                                    darkMode 
                                                        ? 'bg-gray-700 hover:bg-gray-600' 
                                                        : 'bg-gray-50 hover:bg-gray-100'
                                                }`}
                                            >
                                                <div className="flex items-start gap-4">
                                                    <div className="text-4xl">{component.icon}</div>
                                                    <div className="flex-1">
                                                        <h3 className={`font-bold text-lg mb-1 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                            {component.name}
                                                        </h3>
                                                        <span className="text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-200 rounded font-medium">
                                                            {component.category}
                                                        </span>
                                                        <pre className={`mt-3 p-3 rounded text-xs overflow-x-auto code-font ${
                                                            darkMode ? 'bg-gray-900 text-green-400' : 'bg-gray-900 text-green-400'
                                                        }`}>
                                                            {component.code}
                                                        </pre>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Versions Modal */}
                    {showVersions && currentProject?.versions && (
                        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                            <div className={`rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl ${
                                darkMode ? 'bg-gray-800' : 'bg-white'
                            }`}>
                                <div className="p-6 border-b border-gray-200 dark:border-gray-700">
                                    <div className="flex justify-between items-center">
                                        <div>
                                            <h2 className={`text-3xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                                üïê Vers√µes Salvas
                                            </h2>
                                            <p className={`text-sm mt-1 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                                {currentProject.versions.length} vers√£o(√µes) salva(s)
                                            </p>
                                        </div>
                                        <button
                                            onClick={() => setShowVersions(false)}
                                            className={`text-3xl ${darkMode ? 'text-gray-400 hover:text-white' : 'text-gray-500 hover:text-gray-700'} transition`}
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                </div>
                                <div className="p-6 overflow-y-auto max-h-[calc(90vh-140px)]">
                                    <div className="space-y-4">
                                        {currentProject.versions.slice().reverse().map((version, i) => (
                                            <div
                                                key={version.id}
                                                onClick={() => loadVersion(version)}
                                                className={`p-6 rounded-xl shadow-md cursor-pointer transition-all hover:shadow-lg ${
                                                    darkMode 
                                                        ? 'bg-gray-700 hover:bg-gray-600' 
                                                        : 'bg-gray-50 hover:bg-gray-100'
                                                }`}
                                            >
                                                <div className="flex justify-between items-start mb-3">
                                                    <div>
                                                        <span className="version-badge bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-200">
                                                            {version.name}
                                                        </span>
                                                        <p className={`text-sm mt-2 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                                            {version.message}
                                                        </p>
                                                    </div>
                                                    <div className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                                        {new Date(version.timestamp).toLocaleString()}
                                                    </div>
                                                </div>
                                                <div className={`text-xs flex gap-4 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                                    <span>üìè {version.code.split('\n').length} linhas</span>
                                                    <span>üíæ {Math.round(version.code.length / 1024)}KB</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Name Modal */}
                    {showNameModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
                            <div className={`rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl ${
                                darkMode ? 'bg-gray-800' : 'bg-white'
                            }`}>
                                <h2 className={`text-3xl font-bold mb-6 ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                    ‚ú® Novo Projeto
                                </h2>
                                <input
                                    type="text"
                                    value={projectName}
                                    onChange={(e) => setProjectName(e.target.value)}
                                    placeholder="Nome do projeto..."
                                    className={`w-full p-4 border-2 rounded-xl focus:outline-none mb-6 text-lg ${
                                        darkMode
                                            ? 'bg-gray-900 border-gray-700 text-white focus:border-purple-500'
                                            : 'border-gray-200 focus:border-purple-500'
                                    }`}
                                    autoFocus
                                    onKeyPress={(e) => e.key === 'Enter' && confirmCreateProject()}
                                />
                                <div className="flex space-x-3">
                                    <button
                                        onClick={() => {
                                            setShowNameModal(false);
                                            setProjectName('');
                                        }}
                                        className={`flex-1 px-6 py-4 border-2 rounded-xl font-bold transition ${
                                            darkMode
                                                ? 'border-gray-700 text-gray-300 hover:bg-gray-700'
                                                : 'border-gray-300 text-gray-700 hover:bg-gray-50'
                                        }`}
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={confirmCreateProject}
                                        disabled={!projectName.trim()}
                                        className={`flex-1 px-6 py-4 rounded-xl font-bold transition ${
                                            projectName.trim()
                                                ? 'bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white shadow-lg'
                                                : 'bg-gray-300 cursor-not-allowed text-gray-500'
                                        }`}
                                    >
                                        Criar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <footer className={`mt-20 py-10 ${darkMode ? 'bg-gray-800 text-white' : 'bg-gray-800 text-white'}`}>
                        <div className="container mx-auto px-4">
                            <div className="text-center">
                                <h3 className="text-2xl font-bold mb-3">
                                    <span className="text-3xl mr-2">‚ö°</span>
                                    OpenVibe Studio
                                </h3>
                                <p className="text-lg mb-4 opacity-90">
                                    Professional Open Source AI App Builder
                                </p>
                                <div className="flex justify-center gap-6 text-sm opacity-75 flex-wrap">
                                    <span>‚ú® Templates</span>
                                    <span>üß© Componentes</span>
                                    <span>üåô Dark Mode</span>
                                    <span>üíæ Versionamento</span>
                                    <span>üì• Multi-Export</span>
                                    <span>üí∞ 100% Gr√°tis</span>
                                </div>
                                <div className="mt-6 text-xs opacity-50">
                                    React + CodeMirror + Claude API ‚Ä¢ Licen√ßa MIT ‚Ä¢ v3.0
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<OpenVibeStudio />, document.getElementById('root'));
    </script>
</body>
</html>